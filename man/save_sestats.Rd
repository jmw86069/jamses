% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/jam_save_sestats.R
\name{save_sestats}
\alias{save_sestats}
\title{Save SE contrast stats output}
\usage{
save_sestats(
  sestats,
  file = NULL,
  assay_names = NULL,
  contrast_names = NULL,
  cutoff_names = NULL,
  type = c("xlsx", "list"),
  data_content = c("data", "hits"),
  hits_use_lfc = FALSE,
  max_nchar_sheetname = 31,
  abbreviate = FALSE,
  review_output = TRUE,
  sheet_prefix = NULL,
  use_assay_suffix = TRUE,
  width_factor = 1,
  max_rows = NULL,
  colorSub = NULL,
  rename_contrasts = TRUE,
  se = NULL,
  rowData_colnames = NULL,
  row_type = "gene_name",
  hitRule = c(-1, 0, 1),
  hitFormat = "#,##0",
  freezePaneColumn = 2,
  verbose = FALSE,
  ...
)
}
\arguments{
\item{sestats}{\code{list} object output from \code{se_contrast_stats()}}

\item{file}{\code{character} string indicating the filename to save.
When \code{file} is \code{NULL}, output is returned as a \code{list}, equivalent
to \code{type="list"}.}

\item{assay_names}{\code{character} string indicating which assay names
to save, stored in \code{dimnames(sestats$hit_array)$Signal}.
When \code{NULL} then all assay names are saved.}

\item{contrast_names}{\code{character} string indicating which contrasts
to save, stored in \code{dimnames(sestats$hit_array)$Contrasts}.
The default \code{NULL} will save all contrasts.}

\item{type}{\code{character} string indicating the type of file to save.
\itemize{
\item \code{"xlsx"} - saves an Excel xlsx file using \code{jamba::writeOpenxlsx()}.
Each worksheet is renamed so the string length does not exceed
\code{max_nchar_sheetname}, whose default is 31 characters.
\item \code{"list"} - returns a \code{list} of \code{data.frame} objects, equivalent
to the data to be stored in an output file.
This option will \strong{not} save data to \code{file}.
}}

\item{data_content}{\code{character} string describing the data content
to include:
\itemize{
\item \verb{"contrasts","hits"} - include worksheets per \code{contrast_names},
then assemble one \code{"hit sheet"} across all contrasts.
One hit sheet is created for each value in \code{assay_names}.
\item \code{"contrasts"} - (default) include worksheets per \code{contrast_names}
\item \code{"hits"} - include only one \code{"hit sheet"} per value in
\code{assay_names}.
}}

\item{hits_use_lfc}{\code{logical} default FALSE, indicating whether values
in \code{"hits"} columns should use the log2 fold change.
\itemize{
\item \code{FALSE} (default) assigns \code{c(-1, 0, 1)} to indicate directionality
after applying stat thresholds.
\item \code{TRUE} assigns the actual log2 fold change \emph{only for hits} as defined
by the stat thresholds.
}}

\item{max_nchar_sheetname}{\code{integer} number of characters allowed in
Microsoft Excel worksheet names, default 31 characters.}

\item{abbreviate}{\code{logical} indicating whether to abbreviate factor
levels using \code{shortest_unique_abbreviation()}.
This option is \code{FALSE} by default, but may become preferred
after more testing.}

\item{review_output}{\code{logical} indicating whether a summary of output
should be returned as a \code{data.frame} without exporting data. This
summary will indicate all worksheets to be saved, in addition
to the sheetName for each worksheet.}

\item{sheet_prefix}{\code{character} string with optional character prefix
to use when creating worksheet names.}

\item{use_assay_suffix}{\code{logical} indicating whether to include
\code{assay_names} as suffix when forming sheet names, when there is more
than one unique assay name to be saved. This step will
attempt to abbreviate \code{assay_names} by taking up to 4 characters
from each word in the assay name, where each word is
delimited by \code{"[-.:_ ]+"}.
Otherwise, sheet names are forced to be unique by taking a substring
of the contrast name of up to \code{max_nchar_sheetname}, passing any
duplicate strings to \code{jamba::makeNames()} with suffix \code{"_v"}
followed by an integer number.}

\item{width_factor}{\code{numeric} used to adjust relative column widths
in the output Excel worksheets.}

\item{colorSub}{\code{character} vector of colors, optional, used to define
categorical background colors for text string fields in Excel.
The \code{names(colorSub)} are matched to character strings to assign
colors.}

\item{rename_contrasts}{\code{logical} indicating whetheer to apply
\code{contrasts2comp()} to shorten long contrast names.}

\item{se}{\code{SummarizedExperiment}, default NULL, used when
\code{rowData_colnames} is defined.}

\item{rowData_colnames}{\code{character}, default NULL, with optional colnames
used only when \code{se} is also provided. When defined, it provides
additional annotations for each row as defined by \code{rowData(se)}.}

\item{row_type}{\code{character} with custom column name to use for the
primary row identifier. The default \code{"probes"} is often not accurate,
though this may not be problematic in practice.
When defined, the first column is renamed to \code{row_type}.}

\item{hitRule, hitFormat, freezePaneColumn}{arguments passed to
\code{jamba::writeOpenxlsx()}, used only to define the color thresholds
used with conditional formatting. It changes none of the data.
The \code{freezePaneColumn} defines the first non-fixed column when
viewed in Excel, and by default keeps only the first column fixed
when scrolling to the right. Use a higher value if columns added
by \code{rowData_colnames} should also be fixed columns.}

\item{verbose}{\code{logical} indicating whether to print verbose output.}

\item{...}{additional arguments are passed to \code{jamba::writeOpenxlsx()}}
}
\value{
\code{data.frame} when \code{type="xlsx"} or \code{list} when \code{type="list"}.
}
\description{
Save SE contrast stats output
}
\details{
This function is intended as a convenient method to export
a series of statistical tables into organized, formatted Excel
worksheets.

The output will generally contain two types of worksheets:
\enumerate{
\item Each contrast in its own worksheet.
This is option is enabled by including \code{"contrasts"} in
argument \code{data_content}, which is default.
\itemize{
\item If there are multiple "Signals" (e.g. multiple \code{assay_name})
then each contrast/signal combination will be saved to its
own worksheet.
}
\item One table will be created with one column for each contrast,
using values \code{c(1, 0, -1)} to indicate whether the row met the
statistical criteria.
This is option is enabled by including \code{"hits"} in
argument \code{data_content}, which is default.
\itemize{
\item If there are multiple "Signals" (e.g. multiple \code{assay_name})
then one table for each signal will be saved to its
own worksheet.
}
}
\subsection{Output to Excel xlsx or as \code{list}}{
\itemize{
\item To output a \code{list} of \code{data.frame} objects, use:
\verb{type="list", review_output=FALSE}
}
}

\subsection{Worksheet names}{

Because the \code{xlsx} worksheet name is limited to 31 characters, the
contrast names are abbreviated by default. The output of this
function is a \code{data.frame} which includes the relationship of
the contrast and signal, to the abbreviated worksheet name.
}
}
\examples{
se <- make_se_test();

# create SEDesign
sedesign <- groups_to_sedesign(se, group_colnames="group")

# limma contrasts
sestats <- se_contrast_stats(se=se,
   sedesign=sedesign,
   assay_names="counts")

# review_output=TRUE
info_df <- save_sestats(sestats, review_output=TRUE)
info_df

# review_output=FALSE
stat_dfs1 <- save_sestats(sestats, review_output=FALSE, type="list")
head(stat_dfs1[[1]])

# review_output=FALSE, hits_use_lfc=TRUE
stat_dfs <- save_sestats(sestats, review_output=FALSE, type="list", hits_use_lfc=TRUE)
head(stat_dfs[[1]])

set.seed(12)
heatmap_se(se, sestats=sestats)

set.seed(12)
heatmap_se(stat_dfs[[2]], column_names_rot=80,
   column_cex=0.2, row_cex=0.5) +
heatmap_se(se, sestats=sestats, rows=rownames(se))

set.seed(12)
heatmap_se(stat_dfs[[2]], column_names_rot=80,
   column_cex=0.2, row_cex=0.5) +
heatmap_se(stat_dfs1[[2]], column_names_rot=80,
   column_cex=0.2, row_cex=0.5) +
heatmap_se(se, sestats=sestats, rows=rownames(se))

}
\seealso{
Other jamses stats: 
\code{\link{ebayes2dfs}()},
\code{\link{format_hits}()},
\code{\link{handle_na_values}()},
\code{\link{hit_array_to_list}()},
\code{\link{process_sestats_to_hitim}()},
\code{\link{run_limma_replicate}()},
\code{\link{se_contrast_stats}()},
\code{\link{sestats_to_df}()},
\code{\link{sestats_to_dfs}()},
\code{\link{voom_jam}()}
}
\concept{jamses stats}
