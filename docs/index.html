<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jam SummarizedExperiment Stats • jamses</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Jam SummarizedExperiment Stats">
<meta property="og:description" content="Jam SummarizedExperiment Stats methods to
   normalize SummarizedExperiment data, define
   experiment design, visualize the experiment design,
   define statistical contrasts,
   perform differential analysis (via other packages).
   S4 object SEDesign enforces relationship between
   individual samples, design groups, and groups involved
   in statistical contrasts.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">jamses</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.48.900</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://github.com/jmw86069/jamses/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="jamses">jamses<a class="anchor" aria-label="anchor" href="#jamses"></a>
</h1></div>
<p>Jam SummarizedExperiment Stats (jamses)</p>
<p>This package is under active development, as these functions make up a core set of methods used across multiple Omics analysis projects. A summary of goals and relevant features are described below.</p>
<div class="section level2">
<h2 id="goal">Goal<a class="anchor" aria-label="anchor" href="#goal"></a>
</h2>
<p>The core goal is to make data analysis of <code>SummarizedExperiment</code> objects straightforward for common scenarios:</p>
<ul>
<li>
<p>Define a design matrix based upon sample groups</p>
<ul>
<li>by default using <code>~ 0 + group</code> syntax.</li>
</ul>
</li>
<li>
<p>Define statistical contrasts for factor comparisons</p>
<ul>
<li>one or more design factors are recognized</li>
<li>goal to enable one-way and two-way contrasts*</li>
<li>factor comparisons are applied in proper order</li>
</ul>
</li>
<li>
<p>Automate analysis of a series of contrasts</p>
<ul>
<li>allow multiple data matrices stored as <code>assays</code>
</li>
<li>intended to help compare data normalization/processing steps</li>
</ul>
</li>
</ul>
<blockquote>
<p>*Note: <a href="https://www.bioconductor.org/packages/devel/bioc/vignettes/limma/inst/doc/" class="external-link">The Limma User’s Guide</a> describes alternate approaches for one-way and two-way contrasts. The approach used in <code>jamses</code> uses the <code>~0 + x</code> style of grouping, which defines each experiment group with independent replicates. In this context, a two-way contrast is defined as testing the fold change of one-way fold changes. The <code>jamses</code> methods ensure that two-way contrasts compare the same factors in proper order, for example <code>(A_treated - A_control)</code> can be compared to <code>(B_treated - B_control)</code>, but will not be compared to <code>(B_treated - B_knockout)</code>. Similarly, one-way contrasts will only compare one factor change at a time, and would not generate a contrast <code>(A_treated - B_control)</code>.</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="define-experiment-design-and-contrasts">Define experiment design and contrasts<a class="anchor" aria-label="anchor" href="#define-experiment-design-and-contrasts"></a>
</h2>
<ul>
<li>
<p><code><a href="reference/groups_to_sedesign.html">groups_to_sedesign()</a></code> takes by default a <code>data.frame</code> where each column represents an experiment factor, and performs the following steps:</p>
<ul>
<li>defines appropriate experiment <code>design</code> matrix</li>
<li>defines a <code>contrast</code> matrix limited to changes in single experiment factors at a time, combining equivalent contrasts across secondary factors where appropriate, up to <code>max_depth</code> factor depth.</li>
<li>defines an appropriate <code>samples</code> vector typically defined by <code><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames()</a></code> of the input <code>data.frame</code>.</li>
</ul>
</li>
<li>
<p>Output is <code>SEDesign</code> as described:</p>
<ul>
<li>
<code>SE@samples</code> - contains the vector of samples.</li>
<li>
<code>SE@design</code> contains the design matrix.</li>
<li>
<code>SE@contrasts</code> contains the contrasts matrix.</li>
</ul>
</li>
<li><p>The input <code>data.frame</code> columns represent design factors, and column values represent factor levels. If columns are <code>character</code> they are coerced to <code>factor</code>, otherwise the order of existing <code>factor</code> levels is maintained.</p></li>
<li><p>Contrasts are defined such that the first level is the control group in each comparison.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="new-object-class-sedesign">New object class: <code>SEDesign</code>
<a class="anchor" aria-label="anchor" href="#new-object-class-sedesign"></a>
</h2>
<p><code>SEDesign</code> is an S4 object that contains the following slots:</p>
<ul>
<li><p><code>"samples"</code>: a <code>character</code> vector of sample names, derived from <code><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames()</a></code> of the <code>SummarizedExperiment</code> object.</p></li>
<li>
<p><code>"design"</code>: a <code>matrix</code> representing the design matrix, with specific constraints:</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames()</a></code> are equal to <code><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames()</a></code> of the <code>SummarizedExperiment</code> object. This requirement helps ensure that the design and assay data are integrated.</li>
<li>
<code><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames()</a></code> are defined as sample groups, typically equivalent to using <code>model.matrix( ~ 0 + groups )</code>, based upon the <a href="https://www.bioconductor.org/packages/devel/bioc/vignettes/limma/inst/doc/" class="external-link">The Limma User’s Guide</a> from the <code>limma</code> Bioconductor package.</li>
</ul>
</li>
<li>
<p><code>"contrasts"</code>: a <code>matrix</code> representing the contrast matrix used for statistical comparisons, with constraints:</p>
<ul>
<li>
<code>rownames(contrasts)</code> must be equal to <code>colnames(contrasts)</code> in order to ensure all data is properly synchronized.</li>
</ul>
</li>
</ul>
<div class="section level3">
<h3 id="use-cases-for-sedesign">Use cases for <code>SEDesign</code>:<a class="anchor" aria-label="anchor" href="#use-cases-for-sedesign"></a>
</h3>
<ul>
<li>
<p><code>SEDesign</code> can be subset by <code>samples</code> using the form: <code>SE[samples, ]</code></p>
<ul>
<li>Subsetting <code>samples</code> may be useful in order to remove outlier samples, or to focus analysis on a subset of samples within best statistical practices (outside scope of this package).</li>
<li>Subsetting <code>SEDesign</code> by <code>samples</code> will force appropriate subsetting of the <code>design</code> matrix. This subset will cascade to <code>contrasts</code>.</li>
<li>Argument <code>min_reps=1</code> defines the minimum samples required in a <code>design</code> group in order for the group to be retained. It may be beneficial to require at least <code>n=3</code> replicates for analysis for example.</li>
</ul>
</li>
<li>
<p><code>SEDesign</code> can be subset by <code>groups</code> using the form: <code>SE[, groups]</code></p>
<ul>
<li>The <code>design</code> matrix will be subset accordingly.</li>
<li>The <code>samples</code> vector will be subset to remove samples that are not present in any remaining design groups.</li>
<li>The <code>contrasts</code> matrix will be subset to remove all contrasts where one or more groups are no longer present.</li>
</ul>
</li>
<li>
<p><code>SEDesign</code> can be subset by <code>contrasts</code>.</p>
<ul>
<li>The <code>contrasts</code> matrix will be subset accordingly.</li>
<li>The <code>design</code> matrix will be subset to include only those groups required by the contrasts.</li>
</ul>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="accessor-functions-to-sedesign">Accessor functions to <code>SEDesign</code>:<a class="anchor" aria-label="anchor" href="#accessor-functions-to-sedesign"></a>
</h3>
<ul>
<li><p><code>samples()</code> will list the samples, equivalent to <code>rownames(design)</code>.</p></li>
<li><p><code>samples()&lt;-</code> will set values in slot <code>samples</code>, and update <code>rownames(design)</code>.</p></li>
<li><p><code>design()</code> will return the <code>design</code> matrix which defines experiment groups.</p></li>
<li>
<p><code>design()&lt;-</code> will set the <code>design</code> matrix, also ensure that:</p>
<ul>
<li>
<code>colnames(design)</code> are in the same order as <code>rownames(contrasts)</code>, and</li>
<li>
<code>rownames(design)</code> are in the same order as <code>samples</code>.</li>
</ul>
</li>
<li><p><code><a href="https://rdrr.io/r/stats/contrasts.html" class="external-link">contrasts()</a></code> will return the <code>contrasts</code> matrix.</p></li>
<li><p><code>contrasts()&lt;-</code> will set the contrast matrix, and verify the <code>rownames(contrasts)</code> are in the same order as <code>colnames(design)</code>.</p></li>
<li><p><code>groups()</code> will export <code>colnames(design)</code> representing the design groups.</p></li>
<li><p><code>groups()&lt;-</code> will update group names with the corresponding vector.</p></li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="data-normalization">Data normalization<a class="anchor" aria-label="anchor" href="#data-normalization"></a>
</h2>
<p><code>SummarizedExperiment</code> objects are normalized by:</p>
<ul>
<li>
<p><code><a href="reference/se_normalize.html">se_normalize()</a></code> - lightweight wrapper to one of several normalization functions:</p>
<ul>
<li>
<code><a href="https://rdrr.io/pkg/jamma/man/jammanorm.html" class="external-link">jamma::jammanorm()</a></code> which normalizes the median log fold change to zero. This method is also used in <code>DESeq2::estimateSizeFactors()</code> for example. When using <code><a href="https://rdrr.io/pkg/jamma/man/jammaplot.html" class="external-link">jamma::jammaplot()</a></code> for MA-plots, the <code>jammanorm()</code> method is conceptually equivalent to shifting the y-axis values to zero, so the median log fold change is zero. (Assumptions apply.)</li>
<li>
<code><a href="https://rdrr.io/pkg/limma/man/normalizequantiles.html" class="external-link">limma::normalizeQuantiles()</a></code> for quantile normalization.</li>
<li>
<code><a href="https://rdrr.io/pkg/limma/man/removeBatchEffect.html" class="external-link">limma::removeBatchEffect()</a></code> for adjustment of batch effects, recommended for visualization and clustering, not typically recommended prior to statistical comparisons. Instead, we suggest using a blocking factor, which can be passed to <code><a href="reference/se_contrast_stats.html">se_contrast_stats()</a></code>.</li>
</ul>
</li>
<li><p><code><a href="reference/matrix_normalize.html">matrix_normalize()</a></code> - is the core function for <code><a href="reference/se_normalize.html">se_normalize()</a></code> and operates on individual numeric data matrices.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="heatmaps">Heatmaps<a class="anchor" aria-label="anchor" href="#heatmaps"></a>
</h2>
<p><code><a href="reference/heatmap_se.html">heatmap_se()</a></code> is a convenient wrapper for <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html" class="external-link">ComplexHeatmap::Heatmap()</a></code>. Some useful arguments and features are described below:</p>
<ul>
<li>
<code>se</code>: the <code>SummarizedExperiment</code> data for the heatmap</li>
<li>
<code>assay_name</code>: define a specific data matrix to display</li>
<li>
<code>rows</code>: choose a specific subset of rows</li>
<li>
<code>sestats</code>: output from <code><a href="reference/se_contrast_stats.html">se_contrast_stats()</a></code> to display a hit matrix alongside the heatmap. Also <code>rows</code> are automatically subset to show statistical hits.</li>
<li>
<code>top_colnames</code>: display column annotations across the top. When absent, it will auto-detect columns which may have interesting annotations, based upon the cardinality of each column annotation.</li>
<li>
<code>rowData_colnames</code>: display row/gene annotations on the left</li>
<li>
<code>sample_color_list</code>: supply pre-defined set of colors for top and left annotations</li>
<li>
<code>centerby_colnames</code>: optional data centering sub-groups, where data is centered within each centerby group.</li>
<li>
<code>normgroup_colnames</code>: optional normalization groups, also used for independent data centering. Columns are also “split” by this value, visually separating columns by each normgroup.</li>
</ul>
<p>Other options can be passed to <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html" class="external-link">ComplexHeatmap::Heatmap()</a></code>:</p>
<ul>
<li>
<code>row_split</code>: split by <code>rowData(se)</code> column annotations, or by number of dendrogram sub-tree clusters.</li>
</ul>
</div>
<div class="section level2">
<h2 id="statistical-comparisons">Statistical comparisons<a class="anchor" aria-label="anchor" href="#statistical-comparisons"></a>
</h2>
<div class="section level3">
<h3 id="se_contrast_stats-is-the-central-function">
<code>se_contrast_stats()</code> is the central function<a class="anchor" aria-label="anchor" href="#se_contrast_stats-is-the-central-function"></a>
</h3>
<ul>
<li><p>Applies design and contrasts defined by <code>SEDesign</code>, or given specific <code>design</code> and <code>contrasts</code> matrix objects.</p></li>
<li>
<p>Initially calls <code>limma</code> functions on a series of <code>assays</code>, for one or more data matrices in the <code>SummarizedExperiment</code> object.</p>
<ul>
<li>Optionally applies <code>limma-voom</code> methodology for count data, for example RNA-seq or Nanostring, to apply the <code>voom</code> methodology of estimating dispersion and applying weights to contrast stats.</li>
<li>Optionally applies <code>limma-DEqMS</code> methodology for proteomics mass spec data, to apply error model based upon PSM counts per row.</li>
</ul>
</li>
<li>
<p>Applies statistical thresholds to define statistical hits for follow-up:</p>
<ul>
<li>
<code>adjp_cutoff</code>: adjusted P-value threshold</li>
<li>
<code>fold_cutoff</code>: normal space fold change threshold</li>
<li>
<code>mgm_cutoff</code>: “mgm” is an abbreviation for “max group mean”; which requires at least one experiment group involved in the contrast to have group mean at or above this threshold. The cutoff is useful to require at least one group to have signal above a noise threshold.</li>
</ul>
</li>
<li>
<p>Additional threshold options:</p>
<ul>
<li>
<code>p_cutoff</code>: unadjusted P-value threshold</li>
<li>
<code>ave_cutoff</code>: average expression threshold, using the equivalent of <code>limma</code> column <code>AveExpr</code> with the mean group expression. Note this <code>AveExpr</code> value is calculated mean per row across all groups, and is subject to skewing.</li>
<li>
<code>int_adjp_cutoff</code>, <code>int_fold_cutoff</code>, <code>int_mgm_cutoff</code> are optionally used for interaction contrasts, for example sometimes a two-way contrast threshold is more lenient during data mining experiments, eg. <code>int_adjp_cutoff=0.1</code> for example.</li>
</ul>
</li>
<li>
<p>Options:</p>
<ul>
<li>
<code>use_voom=TRUE</code>: enable limmavoom workflow for count data</li>
<li>
<code>posthoc_test="DEqMS"</code>: enable DEqMS post-hoc adjustment to the limma empirical Bayes model fit.</li>
<li>
<code>floor_min</code>, <code>floor_value</code>: logic to handle numeric values below a pre-defined noise threshold, values below this threshold are assigned <code>floor_value</code>. This filtering may allow converting values from <code>0</code> zero to <code>NA</code>, and as such the values do not contribute to replicate measurements. For data with substantial missing measurements, this option may be beneficial.</li>
<li>
<code>block</code>: optional blocking factor, which enables the <code><a href="https://rdrr.io/pkg/limma/man/dupcor.html" class="external-link">limma::duplicateCorrelation()</a></code> calculation, which also applied and used during model fit per the <a href="https://www.bioconductor.org/packages/devel/bioc/vignettes/limma/inst/doc/" class="external-link">The Limma User’s Guide</a>.</li>
</ul>
</li>
<li>
<p>Returns a <code>list</code> referred to as <code>sestats</code>:</p>
<ul>
<li>
<p><code>"hit_array"</code>: <code>array</code> of named numeric vectors indicating direction of statistical hits after applying the relevant threshold cutoffs:</p>
<ul>
<li>
<code>1</code> up-regulated</li>
<li>
<code>-1</code> down-regulated</li>
</ul>
</li>
<li><p><code>"stats_dfs"</code>: <code>list</code> of <code>data.frame</code> for each contrast, where column headers also include the statistical contrast to help confirm the identity of each analysis result.</p></li>
<li><p><code>"stats_df"</code>: one super-wide <code>data.frame</code> with results across all contrasts, assay data matrices, and hit thresholds. This matrix is intended to help filter for hits across the various different contrasts and thresholds.</p></li>
</ul>
</li>
<li>
<p>Save to excel with <code><a href="reference/save_sestats.html">save_sestats()</a></code></p>
<ul>
<li>This function helps automate saving every statistical contrast to its own Excel worksheet.</li>
<li>Each worksheet is styled consistently, making it easy to flip through each worksheet.</li>
</ul>
</li>
<li>
<p>Future work:</p>
<ul>
<li>Port the function <code>plot_comparisons()</code> which creates a visual plot of each one-way and two-way contrast, with axes defined by the experiment factors.</li>
<li>Enable equivalent analysis workflow steps using <code>DESeq2</code> methodology.</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="http://github.com/jmw86069/jamses/" class="external-link">Browse source code</a></li>
<li><a href="http://github.com/jmw86069/jamses/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing jamses</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>James M. Ward <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by James M. Ward.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
