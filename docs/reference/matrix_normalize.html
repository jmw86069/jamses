<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Normalize a numeric data matrix — matrix_normalize • jamses</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Normalize a numeric data matrix — matrix_normalize"><meta property="og:description" content="Normalize a numeric data matrix"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">jamses</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.48.900</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="http://github.com/jmw86069/jamses/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Normalize a numeric data matrix</h1>
    <small class="dont-index">Source: <a href="http://github.com/jmw86069/jamses/blob/HEAD/R/jam_senormalize.R" class="external-link"><code>R/jam_senormalize.R</code></a></small>
    <div class="hidden name"><code>matrix_normalize.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Normalize a numeric data matrix</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">matrix_normalize</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"quantile"</span>, <span class="st">"jammanorm"</span>, <span class="st">"limma_batch_adjust"</span><span class="op">)</span>,</span>
<span>  apply_log2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ifneeded"</span>, <span class="st">"no"</span>, <span class="st">"always"</span><span class="op">)</span>,</span>
<span>  floor <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  enforce_norm_floor <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>quantile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ties <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, jammanorm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>controlGenes <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    minimum_mean <span class="op">=</span> <span class="fl">0</span>, controlSamples <span class="op">=</span> <span class="cn">NULL</span>, centerGroups <span class="op">=</span> <span class="cn">NULL</span>, useMedian <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    noise_floor <span class="op">=</span> <span class="cn">NULL</span>, noise_floor_value <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>, limma_batch_adjust <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>batch <span class="op">=</span></span>
<span>    <span class="cn">NULL</span>, group <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  normgroup <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  subset_columns <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  debug <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p><code>numeric</code> matrix with sample columns, and typically
gene rows, but any measured assay row will meet the assumptions
of the method.</p></dd>


<dt>method</dt>
<dd><p><code>character</code> string indicating which normalization
method to apply.</p></dd>


<dt>apply_log2</dt>
<dd><p><code>character</code> string indicating whether to apply
log2 transformation: <code>"ifneeded"</code> will apply log2 transform
when any absolute value is greater than 40; <code>"no"</code> will not
apply log2 transformation; <code>"always"</code> will apply log2 transform.
Note the log2 transform is applied with <code>jamba::log2signed(x, offset=1)</code>
which is equivalent to <code>log(1 + x)</code> except that negative values
are also transformed using the absolute value, then multiplied
by their original sign.</p></dd>


<dt>floor</dt>
<dd><p><code>numeric</code> value indicating the lowest accepted numeric
value, below which values are assigned to this floor. The default
<code>floor=0</code> requires all values are <code>0</code>, and any values below <code>0</code> are
assigned <code>0</code>. Note that the <code>floor</code> is applied after log2 transform,
when the log2 transform is performed.</p></dd>


<dt>enforce_norm_floor</dt>
<dd><p><code>logical</code> indicating whether to enforce the
<code>floor</code> for the normalized results, default is <code>TRUE</code>. For example,
when <code>floor=0</code> any values at or below <code>0</code> are set to <code>0</code> before
normalization. After normalization some of these values will be
above or below <code>0</code>. When <code>enforce_norm_floor=TRUE</code> these values
will again be set to <code>0</code> because they are considered to be
below the noise threshold of the protocol, and adjustments
are not relevant; also any normalized values below the <code>floor</code>
will also be set to <code>floor</code>.</p></dd>


<dt>params</dt>
<dd><p><code>list</code> of parameters relevant to the <code>method</code> of
normalization. The <code>params</code> should be a <code>list</code> named by the <code>method</code>,
whose values are a list named by the relevant method parameter.
See examples.</p></dd>


<dt>normgroup</dt>
<dd><p><code>character</code> or equivalent vector that defines subgroups
of <code>samples</code> to be normalized indendently of each normgroup. When
<code>NULL</code> then all data is normalized together as default.
The <code>normgroup</code> vector is expected to be in the order of
<code>colnames(x)</code> in the same order.</p></dd>


<dt>subset_columns</dt>
<dd><p><code>integer</code> intended for internal use when
<code>normgroups</code> is provided. This argument is used to instruct
each normalization method to use an appropriate subset of
<code>params</code> based upon the subset of columns being analyzed.</p></dd>


<dt>verbose</dt>
<dd><p><code>logical</code> indicating whether to print verbose output.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p><code>numeric</code> matrix with the same dimensions as the
input matrix <code>x</code>. Some normalization methods return
additional information in <code>attributes(x)</code>, for example
<code>method="jammanorm"</code> will return the vector of housekeeper
genes used in <code>attr(x, "hk")</code> for normalization of each sample
when supplied with <code>controlGenes</code> values.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This function is a wrapper for several relevant normalization
methods that operate on a numeric matrix.</p>
    </div>
    <div id="normalization-methods-implemented-">
    <h2>Normalization Methods Implemented:</h2>
    
<div class="section">
<h3 id="method-quantile-">method='quantile'<a class="anchor" aria-label="anchor" href="#method-quantile-"></a></h3>


<p>Quantile-normalization performed by
<code><a href="https://rdrr.io/pkg/limma/man/normalizequantiles.html" class="external-link">limma::normalizeQuantiles()</a></code>. This method has one
parameter <code>"ties"</code> passed to <code><a href="https://rdrr.io/pkg/limma/man/normalizequantiles.html" class="external-link">limma::normalizeQuantiles()</a></code>,
the default here <code>ties=TRUE</code> which handles tied numeric
expression values in a robust way to avoid unpredictability
otherwise. This option is especially relevant with expression
count data, where integer counts cause a large number
of values to be represented multiple times.</p>
</div>

<div class="section">
<h3 id="method-jammanorm-">method='jammanorm'<a class="anchor" aria-label="anchor" href="#method-jammanorm-"></a></h3>


<p>Median-normalization performed by
<code><a href="https://rdrr.io/pkg/jamma/man/jammanorm.html" class="external-link">jamma::jammanorm()</a></code>. This method shifts expression
data as shown on MA-plots, so the median expression
is zero across all samples, using only the rows that
meet the relevant criteria.</p>
<p>Some relevant criteria to
define rows used for normalization:</p><ul><li><p><code>controlGenes</code> defines specific genes to use for
normalization, such as housekeeper genes. It may also
be useful to use detected genes here, so the normalization
only considers those genes defined as detected by
the protocol.</p></li>
<li><p><code>minimum_mean</code> sets a numeric threshold and requires
the mean expression (shown on the x-axis of the MA-plot)
to be at least this value.</p></li>
</ul><p>Note that when both <code>controlGenes</code> and <code>minimum_mean</code>
are defined, both criteria are enforced. So the <code>controlGenes</code>
are also required to have expression of at least <code>minimum_mean</code>.</p>
<p>Also note that all rows of data are normalized by this method,
only the subset of rows defined by <code>controlGenes</code> and <code>minimum_mean</code>
are used to compute the normalization factor.</p>
</div>

<div class="section">
<h3 id="method-limma-batch-adjust-">method='limma_batch_adjust'<a class="anchor" aria-label="anchor" href="#method-limma-batch-adjust-"></a></h3>


<p>Batch adjustment performed by
<code><a href="https://rdrr.io/pkg/limma/man/removeBatchEffect.html" class="external-link">limma::removeBatchEffect()</a></code> which is intended to apply
batch-adjustment as a form of normalization, but which
does not represent full normalization itself. There are
two relevant parameters: <code>"batch"</code> which is a vector of
batch values in order of <code>colnames(x)</code>, and <code>"group"</code>
which is a vector of sample groups in order of <code>colnames(x)</code>.</p>
</div>

    </div>
    <div id="normalization-groups-via-normgroup">
    <h2>Normalization groups via <code>normgroup</code></h2>
    <p>The <code>normgroup</code> argument is intended as a convenient method to
apply a normalization method to each independent <code>normgroup</code>.
This situation is especially useful when a study contains
multiple tissue types, or multiple data types, that may not be
appropriate to normalize directly relative to one another.</p>
<p>For example, one could normalize total RNA-seq and nascent 4sU-seq
data independently, without expectation that the two would ever
have a common frame of reference to normalize one relative to another.
However, both may be amenable to <code>"quantile"</code> or
<code>"jammanorm"</code> median normalization.</p>
<p>Similarly, one could normalize each tissue type independently,
which may be appropriate when analyzing data that contains very
different mammalian tissue organ samples, such as muscle and brain.</p>
<p>It would generally not be appropriate to use quantile normalization
across muscle and brain samples, since the overall pattern and
distribution of expression values is not expected to be similar.
Quantile normalize assumes (and imposes) a common distribution,
by adjusting mean expression signal at each quantile to a common
mean expression across all samples.</p>
<p>For a rough approximation of cross-tissue normalization, one
could apply <code>"quantile"</code> normalization within each <code>normgroup</code> defined
by tissue type, then apply <code>"jammanorm"</code> median normalization to
apply a linear adjustment of signal across tissue types. The median
normalization does not affect distribution, thus will not affect
intra-tissue contrasts, except by adjusting its overall signal
which may change downstream assumptions regarding signal thresholds.</p>
<p>It is recommended not to compare directly across tissue types.
In some cases a two-way contrast may be appropriate, where
fold change within one tissue type is compared to the
fold change within another tissue type. However, even in that
case the two tissue types do not need to be normalized relative to
each other upfront - the within-tissue fold change serves as
one method of normalizing the observations across tissue types.</p>
    </div>
    <div id="other-useful-parameters">
    <h2>Other useful parameters</h2>
    <p>Note the <code>floor</code> and <code>enforce_norm_floor</code> have recommended
default values <code>floor=0</code> and <code>enforce_norm_floor=TRUE</code>.</p><ul><li><p><code>floor</code> is applied prior to normalization, typically
to minimize effects of low, noisy signal on the normalization
process itself. Specifically, this floor is used to remove negative
values, which may be by-products of upstream signal processing.
"A measured signal at or below the noise floor of a platform
technology is effectively the same as a signal at the noise floor."</p></li>
<li><p><code>enforce_norm_floor</code> is applied after normalization, typically
as a convenience, also to prevent low, noisy signal from
contributing to downstream analysis steps.</p></li>
</ul><p>These defaults will set any assay value at or below <code>0</code> to <code>0</code>,
and after normalization any values whose input values were
at or below <code>0</code> will also be set to <code>0</code> to prevent normalizing
a value of <code>0</code> to non-zero. Any normalized value at or
below <code>0</code> will also be set to <code>0</code> to prevent results from
containing negative normalized values.</p>
<p>The assumption for this default is that a value of zero
is not a measurement but represents the lack of a measurement.
Similarly, the intent of <code>floor</code> is a numeric threshold at or
below there is no confidence in the reported measurement, therefore
values at or below this threshold are treated as equivalent
to the threshold for the purpose of downstream analyses.</p>
<p>Some platforms like QPCR for example, have substantially lower
confidence at high CT values, where expression values
using the equation <code>2^(40-CT)</code> might impose a noise threshold
at expression 32 or lower. This noise threshold for QPCR
means any expression measurement of 32 or lower is as likely
to be <code>32</code> as it is to be <code>2</code>, and therefore any differences
between reported expression of <code>32</code> and <code>2</code> should not be
considered relevant. Applying <code>floor=32</code> in this case
accomplishes this goal by setting all values at or below
<code>32</code> to <code>32</code>. Of course when using this method <code>matrix_normalize()</code>
the data should be log2 transformed, which means the <code>floor</code>
should also be log2 transformed, e.g. <code>floor=log2(32)</code>
which is <code>floor=5</code>.</p>
<p>One alternative might be to set values at or below zero to <code>NA</code>
prior to normalization, and before calling <code>matrix_normalize()</code>.
In this case, only non-NA values will be used during
normalization according to the <code>method</code> being used.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other jamses stats: 
<code><a href="ebayes2dfs.html">ebayes2dfs</a>()</code>,
<code><a href="handle_na_values.html">handle_na_values</a>()</code>,
<code><a href="run_limma_replicate.html">run_limma_replicate</a>()</code>,
<code><a href="se_contrast_stats.html">se_contrast_stats</a>()</code>,
<code><a href="se_normalize.html">se_normalize</a>()</code>,
<code><a href="voom_jam.html">voom_jam</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># use farrisdata real world data if available</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu">jamba</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jamba/man/check_pkg_installed.html" class="external-link">check_pkg_installed</a></span><span class="op">(</span><span class="st">"farrisdata"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/SummarizedExperiment" class="external-link">SummarizedExperiment</a></span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="co"># test matrix_normalize()</span></span></span>
<span class="r-in"><span>   <span class="va">GeneSE</span> <span class="op">&lt;-</span> <span class="fu">farrisdata</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/farrisdata/man/farrisGeneSE.html" class="external-link">farrisGeneSE</a></span>;</span></span>
<span class="r-in"><span>   <span class="va">imatrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assays</a></span><span class="op">(</span><span class="va">GeneSE</span><span class="op">)</span><span class="op">$</span><span class="va">raw_counts</span>;</span></span>
<span class="r-in"><span>   <span class="va">genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">imatrix</span><span class="op">)</span>;</span></span>
<span class="r-in"><span>   <span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">imatrix</span><span class="op">)</span>;</span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">imatrix</span><span class="op">)</span>;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="co"># matrix_normalize()</span></span></span>
<span class="r-in"><span>   <span class="co"># normalize the numeric matrix directly</span></span></span>
<span class="r-in"><span>   <span class="va">imatrix_norm</span> <span class="op">&lt;-</span> <span class="fu">matrix_normalize</span><span class="op">(</span><span class="va">imatrix</span>,</span></span>
<span class="r-in"><span>      genes<span class="op">=</span><span class="va">genes</span>,</span></span>
<span class="r-in"><span>      samples<span class="op">=</span><span class="va">samples</span>,</span></span>
<span class="r-in"><span>      method<span class="op">=</span><span class="st">"jammanorm"</span>,</span></span>
<span class="r-in"><span>      params<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>minimum_mean<span class="op">=</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">imatrix_norm</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="co"># review normalization factors</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span>digits<span class="op">=</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">imatrix_norm</span>, <span class="st">"nf"</span><span class="op">)</span><span class="op">)</span>;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="co"># example for quantile normalization</span></span></span>
<span class="r-in"><span>   <span class="va">imatrix_quant</span> <span class="op">&lt;-</span> <span class="fu">matrix_normalize</span><span class="op">(</span><span class="va">imatrix</span>,</span></span>
<span class="r-in"><span>      genes<span class="op">=</span><span class="va">genes</span>,</span></span>
<span class="r-in"><span>      samples<span class="op">=</span><span class="va">samples</span>,</span></span>
<span class="r-in"><span>      method<span class="op">=</span><span class="st">"quantile"</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">imatrix_quant</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ##  (<span style="color: #00FFFF; font-weight: bold;">11:53:08</span>) 28Aug2023:   <span style="color: #FF8700;">matrix_normalize(): </span><span style="color: #00AFFF;">Applied floor:</span><span style="color: #87D7FF;">0</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ##  (<span style="color: #00FFFF; font-weight: bold;">11:53:08</span>) 28Aug2023:   <span style="color: #FF8700;">matrix_normalize(): </span><span style="color: #00AFFF;">Calling </span><span style="color: #FF8700;">jammanorm():</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00AFFF;">      minimum_mean:</span><span style="color: #87D7FF;">0</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00AFFF;">      useMedian:</span><span style="color: #87D7FF;">FALSE</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ##  (<span style="color: #00FFFF; font-weight: bold;">11:53:08</span>) 28Aug2023:   <span style="color: #FF8700;">jammanorm(): </span><span style="color: #00AFFF;">length(controlGenes):</span><span style="color: #FF8700;">49341</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ##  (<span style="color: #00FFFF; font-weight: bold;">11:53:09</span>) 28Aug2023:   <span style="color: #FF8700;">matrix_normalize(): </span><span style="color: #00AFFF;">Applied floor:</span><span style="color: #87D7FF;">0</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "dim"      "dimnames"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># simulate reasonably common expression matrix</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>;</span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">9000</span><span class="op">)</span><span class="op">/</span><span class="fl">4</span>, ncol<span class="op">=</span><span class="fl">9</span><span class="op">)</span>;</span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sample"</span>, <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">]</span><span class="op">)</span>;</span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"gene"</span>, <span class="fu">jamba</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jamba/man/padInteger.html" class="external-link">padInteger</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rowmeans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, shape1<span class="op">=</span><span class="fl">2</span>, shape2<span class="op">=</span><span class="fl">5</span><span class="op">)</span><span class="op">*</span><span class="fl">14</span><span class="op">+</span><span class="fl">2</span>;</span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="va">rowmeans</span>;</span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>   <span class="va">x</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>;</span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># display MA-plot with jamma::jammaplot()</span></span></span>
<span class="r-in"><span><span class="fu">jamma</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jamma/man/jammaplot.html" class="external-link">jammaplot</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="matrix_normalize-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># normalize by jammanorm</span></span></span>
<span class="r-in"><span><span class="va">xnorm</span> <span class="op">&lt;-</span> <span class="fu">matrix_normalize</span><span class="op">(</span><span class="va">x</span>, method<span class="op">=</span><span class="st">"jammanorm"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ##  (<span style="color: #00FFFF; font-weight: bold;">11:53:09</span>) 28Aug2023:   <span style="color: #FF8700;">matrix_normalize(): </span><span style="color: #00AFFF;">Applied floor:</span><span style="color: #87D7FF;">0</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ##  (<span style="color: #00FFFF; font-weight: bold;">11:53:09</span>) 28Aug2023:   <span style="color: #FF8700;">matrix_normalize(): </span><span style="color: #00AFFF;">Calling </span><span style="color: #FF8700;">jammanorm():</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00AFFF;">      minimum_mean:</span><span style="color: #87D7FF;">0</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00AFFF;">      useMedian:</span><span style="color: #87D7FF;">FALSE</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ##  (<span style="color: #00FFFF; font-weight: bold;">11:53:09</span>) 28Aug2023:   <span style="color: #FF8700;">jammanorm(): </span><span style="color: #00AFFF;">length(controlGenes):</span><span style="color: #FF8700;">1000</span> </span>
<span class="r-in"><span><span class="fu">jamma</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jamma/man/jammaplot.html" class="external-link">jammaplot</a></span><span class="op">(</span><span class="va">xnorm</span>, maintitle<span class="op">=</span><span class="st">"method='jammanorm'"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="matrix_normalize-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># normalize by jammanorm with housekeeper genes</span></span></span>
<span class="r-in"><span><span class="va">hk_genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>;</span></span>
<span class="r-in"><span><span class="va">xnormhk</span> <span class="op">&lt;-</span> <span class="fu">matrix_normalize</span><span class="op">(</span><span class="va">x</span>,</span></span>
<span class="r-in"><span>   method<span class="op">=</span><span class="st">"jammanorm"</span>,</span></span>
<span class="r-in"><span>   params<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>jammanorm<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>controlGenes<span class="op">=</span><span class="va">hk_genes</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ##  (<span style="color: #00FFFF; font-weight: bold;">11:53:10</span>) 28Aug2023:   <span style="color: #FF8700;">matrix_normalize(): </span><span style="color: #00AFFF;">Applied floor:</span><span style="color: #87D7FF;">0</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ##  (<span style="color: #00FFFF; font-weight: bold;">11:53:10</span>) 28Aug2023:   <span style="color: #FF8700;">matrix_normalize(): </span><span style="color: #00AFFF;">Calling </span><span style="color: #FF8700;">jammanorm():</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00AFFF;">      minimum_mean:</span><span style="color: #87D7FF;">0</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00AFFF;">      useMedian:</span><span style="color: #87D7FF;">FALSE</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ##  (<span style="color: #00FFFF; font-weight: bold;">11:53:10</span>) 28Aug2023:   <span style="color: #FF8700;">jammanorm(): </span><span style="color: #00AFFF;">length(controlGenes):</span><span style="color: #FF8700;">10</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">jamma</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jamma/man/jammaplot.html" class="external-link">jammaplot</a></span><span class="op">(</span><span class="va">xnormhk</span>,</span></span>
<span class="r-in"><span>   maintitle<span class="op">=</span><span class="st">"method='jammanorm' with housekeeper genes"</span>,</span></span>
<span class="r-in"><span>   highlightPoints<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>housekeepers<span class="op">=</span><span class="va">hk_genes</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   highlightColor<span class="op">=</span><span class="st">"green"</span><span class="op">)</span>;</span></span>
<span class="r-plt img"><img src="matrix_normalize-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">xnormhk6</span> <span class="op">&lt;-</span> <span class="fu">matrix_normalize</span><span class="op">(</span><span class="va">x</span>,</span></span>
<span class="r-in"><span>   method<span class="op">=</span><span class="st">"jammanorm"</span>,</span></span>
<span class="r-in"><span>   params<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>jammanorm<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      controlGenes<span class="op">=</span><span class="va">hk_genes</span>,</span></span>
<span class="r-in"><span>      minimum_mean<span class="op">=</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ##  (<span style="color: #00FFFF; font-weight: bold;">11:53:10</span>) 28Aug2023:   <span style="color: #FF8700;">matrix_normalize(): </span><span style="color: #00AFFF;">Applied floor:</span><span style="color: #87D7FF;">0</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ##  (<span style="color: #00FFFF; font-weight: bold;">11:53:10</span>) 28Aug2023:   <span style="color: #FF8700;">matrix_normalize(): </span><span style="color: #00AFFF;">Calling </span><span style="color: #FF8700;">jammanorm():</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00AFFF;">      minimum_mean:</span><span style="color: #87D7FF;">6</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00AFFF;">      useMedian:</span><span style="color: #87D7FF;">FALSE</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ##  (<span style="color: #00FFFF; font-weight: bold;">11:53:10</span>) 28Aug2023:   <span style="color: #FF8700;">jammanorm(): </span><span style="color: #00AFFF;">length(controlGenes):</span><span style="color: #FF8700;">10</span> </span>
<span class="r-in"><span><span class="va">hk_used</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">xnormhk6</span>, <span class="st">"hk"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>;</span></span>
<span class="r-in"><span><span class="fu">jamma</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jamma/man/jammaplot.html" class="external-link">jammaplot</a></span><span class="op">(</span><span class="va">xnormhk6</span>,</span></span>
<span class="r-in"><span>   maintitle<span class="op">=</span><span class="st">"method='jammanorm' with housekeeper genes, minimum_mean=6"</span>,</span></span>
<span class="r-in"><span>   highlightPoints<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>housekeepers<span class="op">=</span><span class="va">hk_genes</span>,</span></span>
<span class="r-in"><span>      hk_used<span class="op">=</span><span class="va">hk_used</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   highlightColor<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"green"</span><span class="op">)</span><span class="op">)</span>;</span></span>
<span class="r-plt img"><img src="matrix_normalize-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># normalize by quantile</span></span></span>
<span class="r-in"><span><span class="va">xquant</span> <span class="op">&lt;-</span> <span class="fu">matrix_normalize</span><span class="op">(</span><span class="va">x</span>, method<span class="op">=</span><span class="st">"quantile"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ##  (<span style="color: #00FFFF; font-weight: bold;">11:53:10</span>) 28Aug2023:   <span style="color: #FF8700;">matrix_normalize(): </span><span style="color: #00AFFF;">Applied floor:</span><span style="color: #87D7FF;">0</span> </span>
<span class="r-in"><span><span class="fu">jamma</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jamma/man/jammaplot.html" class="external-link">jammaplot</a></span><span class="op">(</span><span class="va">xquant</span>,</span></span>
<span class="r-in"><span>   maintitle<span class="op">=</span><span class="st">"method='quantile'"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="matrix_normalize-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># simulate higher noise for lower signal</span></span></span>
<span class="r-in"><span><span class="va">rownoise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">3</span> <span class="op">/</span> <span class="op">(</span><span class="op">(</span><span class="va">rowmeans</span><span class="op">*</span><span class="fl">1.5</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span>;</span></span>
<span class="r-in"><span><span class="va">xnoise</span> <span class="op">&lt;-</span> <span class="va">x</span>;</span></span>
<span class="r-in"><span><span class="va">xnoise</span> <span class="op">&lt;-</span> <span class="va">xnoise</span> <span class="op">+</span> <span class="va">rownoise</span>;</span></span>
<span class="r-in"><span><span class="fu">jamma</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jamma/man/jammaplot.html" class="external-link">jammaplot</a></span><span class="op">(</span><span class="va">xnoise</span>,</span></span>
<span class="r-in"><span>   maintitle<span class="op">=</span><span class="st">"simulated higher noise at lower signal"</span><span class="op">)</span>;</span></span>
<span class="r-plt img"><img src="matrix_normalize-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># simulate non-linearity across signal</span></span></span>
<span class="r-in"><span><span class="co"># sin(seq(from=pi*4/10, to=pi*7/10, length.out=100))-0.8</span></span></span>
<span class="r-in"><span><span class="va">rowadjust</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">pi</span> <span class="op">*</span> <span class="fu">jamba</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jamba/man/normScale.html" class="external-link">normScale</a></span><span class="op">(</span><span class="va">rowmeans</span>, from<span class="op">=</span><span class="fl">3.5</span><span class="op">/</span><span class="fl">10</span>, to<span class="op">=</span><span class="fl">5.5</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span><span class="fl">0.9</span><span class="op">)</span> <span class="op">*</span> <span class="fl">20</span>;</span></span>
<span class="r-in"><span><span class="va">xwarp</span> <span class="op">&lt;-</span> <span class="va">xnoise</span>;</span></span>
<span class="r-in"><span><span class="va">xwarp</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">xnoise</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">+</span> <span class="va">rowadjust</span>;</span></span>
<span class="r-in"><span><span class="fu">jamma</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jamma/man/jammaplot.html" class="external-link">jammaplot</a></span><span class="op">(</span><span class="va">xwarp</span>,</span></span>
<span class="r-in"><span>   maintitle<span class="op">=</span><span class="st">"signal-dependent noise and non-linear effects"</span><span class="op">)</span>;</span></span>
<span class="r-plt img"><img src="matrix_normalize-7.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># quantile-normalization is indicated for this scenario</span></span></span>
<span class="r-in"><span><span class="va">xwarpnorm</span> <span class="op">&lt;-</span> <span class="fu">matrix_normalize</span><span class="op">(</span><span class="va">xwarp</span>,</span></span>
<span class="r-in"><span>   method<span class="op">=</span><span class="st">"quantile"</span><span class="op">)</span>;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ##  (<span style="color: #00FFFF; font-weight: bold;">11:53:10</span>) 28Aug2023:   <span style="color: #FF8700;">matrix_normalize(): </span><span style="color: #00AFFF;">Applied floor:</span><span style="color: #87D7FF;">0</span> </span>
<span class="r-in"><span><span class="va">jp</span> <span class="op">&lt;-</span> <span class="fu">jamma</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jamma/man/jammaplot.html" class="external-link">jammaplot</a></span><span class="op">(</span><span class="va">xwarpnorm</span>,</span></span>
<span class="r-in"><span>   maintitle<span class="op">=</span><span class="st">"quantile-normalized: signal-dependent noise and non-linear effects"</span><span class="op">)</span>;</span></span>
<span class="r-plt img"><img src="matrix_normalize-8.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by James M. Ward.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

