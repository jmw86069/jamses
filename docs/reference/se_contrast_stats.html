<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Compute contrast statistics on SummarizedExperiment data — se_contrast_stats • jamses</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Compute contrast statistics on SummarizedExperiment data — se_contrast_stats"><meta property="og:description" content="Compute contrast statistics on SummarizedExperiment data"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">jamses</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.50.900</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="http://github.com/jmw86069/jamses/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Compute contrast statistics on SummarizedExperiment data</h1>
    <small class="dont-index">Source: <a href="http://github.com/jmw86069/jamses/blob/HEAD/R/jam_secontrasts.R" class="external-link"><code>R/jam_secontrasts.R</code></a></small>
    <div class="hidden name"><code>se_contrast_stats.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Compute contrast statistics on SummarizedExperiment data</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">se_contrast_stats</span><span class="op">(</span></span>
<span>  <span class="va">se</span>,</span>
<span>  <span class="va">assay_names</span>,</span>
<span>  adjp_cutoff <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  p_cutoff <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fold_cutoff <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>  int_adjp_cutoff <span class="op">=</span> <span class="va">adjp_cutoff</span>,</span>
<span>  int_p_cutoff <span class="op">=</span> <span class="va">p_cutoff</span>,</span>
<span>  int_fold_cutoff <span class="op">=</span> <span class="va">fold_cutoff</span>,</span>
<span>  mgm_cutoff <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ave_cutoff <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  confint <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  floor_min <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  floor_value <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sedesign <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  icontrasts <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  idesign <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  igenes <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  isamples <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  enforce_design <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  use_voom <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  voom_block_twostep <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  posthoc_test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"DEqMS"</span><span class="op">)</span>,</span>
<span>  posthoc_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>DEqMS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>PSM_counts <span class="op">=</span> <span class="cn">NULL</span>, fit.method <span class="op">=</span> <span class="st">"loess"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  robust <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  handle_na <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"full1"</span>, <span class="st">"full"</span>, <span class="st">"partial"</span>, <span class="st">"all"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>  na_value <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  rowData_colnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SYMBOL"</span><span class="op">)</span>,</span>
<span>  collapse_by_gene <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  block <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  correlation <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max_correlation_rows <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  normgroup <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  do_normgroups <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>se</dt>
<dd><p><code>SummarizedExperiment</code> object.</p><ul><li><p>Note that <code>colnames(se)</code> should match the samples in <code>sedesign</code>,
or the <code>rownames(idesign)</code> when <code>sedesign</code> is not supplied.</p></li>
<li><p>Data is subset by <code>colnames(se)</code> using <code>isamples</code> when supplied,
and <code>rownames(se)</code> when <code>igenes</code> is supplied.</p></li>
<li><p>Note argument <code>rowData_colnames</code> can be used to retain some
<code>rowData(se)</code> columns in the stat <code>data.frame</code> summaries for
convenience, particularly helpful when analyzing microarray data
where the <code>rownames(se)</code> represent probe ID or assay ID.</p></li>
</ul></dd>


<dt>assay_names</dt>
<dd><p><code>character</code> vector with one or more assay names
from <code>names(assays(se))</code>.</p></dd>


<dt>adjp_cutoff</dt>
<dd><p><code>numeric</code> value threshold with the adjusted P-value
at or below which a contrast result can be considered a statistical
hit.
This threshold is applied in addition to other <code>cutoff</code> values.</p></dd>


<dt>p_cutoff</dt>
<dd><p><code>numeric</code> value threshold with the unadjusted P-value
at or below which a contrast result can be considered a statistical
hit. This argument is not recommended, in favor of using <code>adjp_cutoff</code>.
This threshold is applied in addition to other <code>cutoff</code> values.</p></dd>


<dt>fold_cutoff</dt>
<dd><p><code>numeric</code> value threshold indicating the normal
absolute fold change at or above which a contrast result can be
considered a statistical hit. For clarity, this threshold is normal
space fold change, for example 2-fold would be <code>fold_cutoff=2</code>.</p></dd>


<dt>int_adjp_cutoff, int_p_cutoff, int_fold_cutoff</dt>
<dd><p>optional thresholds
used only when a two-way interaction style contrast is detected.
These optional thresholds may be useful to apply more lenient criteria
to interaction contrasts, but in that event are cautioned to be
used for data mining exercises. Ideally, the thresholds are identical
between pairwise and interaction contrasts, and ideally there are
enough replicates in the data to support the interaction contrasts
with sufficient confidence to make those comparisons.</p></dd>


<dt>mgm_cutoff</dt>
<dd><p><code>numeric</code> value threshold of the maximum group mean
value required in each contrast for the contrast to be considered
a statistical hit.
The "max group mean" logic requires only one
group in a contrast to be above this threshold, while all other
groups can have values below the threshold.
This threshold is applied in addition to other <code>cutoff</code> values.</p></dd>


<dt>ave_cutoff</dt>
<dd><p><code>numeric</code> value threshold of the average expression
as reported by <code><a href="https://rdrr.io/pkg/limma/man/lmFit.html" class="external-link">limma::lmFit()</a></code>, within each normgroup if relevant,
for the contrast to be considered a statistical hit.
This threshold is applied in addition to other <code>cutoff</code> values.
Typically the column "AvgExpr" is calculated as a row mean.</p></dd>


<dt>confint</dt>
<dd><p><code>logical</code> passed to <code><a href="https://rdrr.io/pkg/limma/man/toptable.html" class="external-link">limma::topTable()</a></code> indicating
whether to calculate 95% confidence intervals for log2 fold change
<code>logFC</code> values. Alternatively it can be a <code>numeric</code> value between
zero and one specifying a specific confidence interval.</p></dd>


<dt>floor_min, floor_value</dt>
<dd><p><code>numeric</code> minimum value (floor_min) at
or below which <code>numeric</code> values in the assay data matrix are
reverted to <code>floor_value</code> as a replacement. This option is
valuable to set all <code>numeric</code> values at or below zero to zero,
or to set all values at or below zero to <code>NA</code> in circumstances
where zero indicates "no measurement" and would be more accurately
represented as a missing measurement than a measurement of <code>0</code>.</p></dd>


<dt>sedesign</dt>
<dd><p><code>SEDesign</code> object as defined by <code><a href="groups_to_sedesign.html">groups_to_sedesign()</a></code>,
with slotNames <code>"design"</code>, <code>"contrasts"</code>, and <code>"samples"</code>.
The arguments <code>idesign</code> and <code>icontrasts</code> are ignored when this
argument is defined.</p></dd>


<dt>icontrasts, idesign</dt>
<dd><p><code>numeric</code> matrices representing statistical
contrasts, and sample-group design matrices. These values are ignored
when <code>sedesign</code> is defined.</p></dd>


<dt>igenes</dt>
<dd><p><code>character</code> vector with optional subset of <code>rownames(se)</code>,
by default it uses all <code>rownames(se)</code>.</p></dd>


<dt>isamples</dt>
<dd><p><code>character</code> vector with optional subset of <code>colnames(se)</code>,
by default it uses <code>colnames(se)</code> that are also defined in the design
matrix.</p></dd>


<dt>enforce_design</dt>
<dd><p><code>logical</code> (this option is not implemented).
By default the design matrix is used to subset the input <code>colnames(se)</code>
as needed, and <code>isamples</code> is used to subset the design matrix
and corresponding contrasts as relevant.</p></dd>


<dt>use_voom</dt>
<dd><p><code>logical</code> indicating whether to apply <code>limma-voom</code>
analysis steps. When applied, data is not scaled using <code>limma:voom()</code>,
instead uses data as supplied.</p></dd>


<dt>voom_block_twostep</dt>
<dd><p><code>logical</code> indicating whether to perform the
"two-step" voom methodology when <code>block</code> is also supplied.
This workflow is recommended by voom authors:</p><ul><li><p>call <code>voom()</code> first without <code>block</code> to determine overall <code>weights</code></p></li>
<li><p>call <code>duplicateCorrelation()</code> if necessary, using the voom <code>weights</code>,
and the <code>block</code> argument, to calculate <code>correlation</code>.</p></li>
<li><p>call <code>voom()</code> again using the <code>correlation</code>, <code>weights</code>, and <code>block</code>
arguments. This produces improved <code>weights</code>.</p></li>
<li><p>call <code>duplicateCorrelation()</code> again with the updated <code>weights</code>,
and <code>block</code> in order to calculate improved <code>correlation</code>.</p></li>
<li><p>Then proceed with <code>lmFit()</code> using appropriate <code>weights</code> using
<code>block</code>; and appropriate <code>correlation</code> also using the proper <code>weights</code>
and <code>block</code>.</p></li>
</ul></dd>


<dt>posthoc_test</dt>
<dd><p><code>character</code> string indicating an optional post-hoc
test to apply.</p><ul><li><p><code>"none"</code>: applies <code><a href="https://rdrr.io/pkg/limma/man/ebayes.html" class="external-link">limma::eBayes()</a></code> by default, the moderated t-test.</p></li>
<li><p><code>"DEqMS"</code>: applies adjustment for proteomics measurements provided
by the package <code>"DEqMS"</code>. See <code>posthoc_args</code>.</p></li>
</ul></dd>


<dt>posthoc_args</dt>
<dd><p><code>list</code> named by the <code>posthoc_test</code> above.
<code>"DEqMS"</code> recognizes two arguments, which are passed to
<code>DEqMS::spectraCounteBayes()</code>:</p><ul><li><p><code>"PSM_counts"</code>: a <code>numeric</code> vector of peptide spectra matched, one
per <code>igenes</code> or <code>rownames(se)</code>. These values are used by DEqMS to
model variability based upon the number of spectra as the key
measure of confidence.</p></li>
<li><p><code>"fit.method"</code>: <code>character</code> name of the model to use, default
is <code>"loess"</code>.</p></li>
</ul></dd>


<dt>weights</dt>
<dd><p><code>numeric</code> non-negative precision weights passed to
<code><a href="https://rdrr.io/pkg/limma/man/lmFit.html" class="external-link">limma::lmFit()</a></code>, either as a matrix with nrow and ncol that
match <code>igenes</code> and <code>isamples</code>, respectively, or matching one
of <code>length(igenes)</code> or <code>length(isamples)</code>. When <code>igenes</code> or <code>isamples</code>
are not supplied, it uses <code>nrow(se)</code> or <code>ncol(se)</code>, respectively.</p></dd>


<dt>robust</dt>
<dd><p><code>logical</code> passed to <code><a href="https://rdrr.io/pkg/limma/man/ebayes.html" class="external-link">limma::eBayes()</a></code>, whether estimation
of <code>df.prior</code> and <code>var.prior</code> should be robust against outlier
sample variances.</p></dd>


<dt>handle_na</dt>
<dd><p><code>character</code> string indicating how to handle <code>NA</code>
values in the data matrix, passed to <code><a href="handle_na_values.html">handle_na_values()</a></code>.</p><ul><li><p><code>"partial"</code>: Replace <code>NA</code> values with <code>na_value</code>,
except when an entire group is <code>NA</code> the entire group is kept at <code>NA</code>.</p></li>
<li><p><code>"full"</code>: Retain <code>NA</code> values, except when an entire group is <code>NA</code>
the replicate values are replaced with <code>na_value</code>. The option
<code>"full1"</code> may be preferred, since it only replaces one value
in the group, therefore does not misrepresent the variability
of the group as zero.</p></li>
<li><p><code>"full1"</code>: Retain <code>NA</code> values, except when an entire group is <code>NA</code>,
one replicate value in the group is replaced with <code>na_value</code>. By
replacing only one replicate with <code>na_value</code> the group does not
have a variance/dispersion, forcing the variance to be determined by
the other group in the contrast, while still allowing an approximate
fold change to be calculated. This option is suitable when there
is a noise floor above zero, as it retains an approximate
fold change while estimating a P-value using only the variance
derived from the non-<code>NA</code> group.</p></li>
<li><p><code>"all"</code>: replace all <code>NA</code> values with <code>na_value</code>.</p></li>
<li><p><code>"none"</code>: perform no replacement of <code>NA</code> values.</p></li>
</ul></dd>


<dt>na_value</dt>
<dd><p><code>numeric</code> passed to <code><a href="handle_na_values.html">handle_na_values()</a></code></p></dd>


<dt>rowData_colnames</dt>
<dd><p><code>character</code> vector of colnames in <code>rowData(se)</code>
that should be retained in each stat <code>data.frame</code> produced
as output. The values in <code>rowData_colnames</code> are intersected
with <code>colnames(rowData(se))</code> to determine which columns to keep.</p></dd>


<dt>collapse_by_gene</dt>
<dd><p><code>logical</code> (not currently implemented).</p></dd>


<dt>block</dt>
<dd><p><code>character</code>, <code>factor</code>, or <code>numeric</code> used as a blocking
factor, using argument <code>block</code> in <code><a href="https://rdrr.io/pkg/limma/man/lmFit.html" class="external-link">limma::lmFit()</a></code> for example.
Currently this argument must be supplied as a vector in order
of <code>isamples</code>, or when <code>isamples</code> is not supplied <code>colnames(se)</code>.
In future, <code>block</code> will accept <code>colnames(colData(se))</code>.</p></dd>


<dt>correlation</dt>
<dd><p>optional inter-duplicate or inter-technical
correlation matrix passed to <code><a href="https://rdrr.io/pkg/limma/man/lmFit.html" class="external-link">limma::lmFit()</a></code>.</p></dd>


<dt>max_correlation_rows</dt>
<dd><p><code>numeric</code> maximum number of rows in
<code>imatrix</code> to use when calling <code><a href="https://rdrr.io/pkg/limma/man/dupcor.html" class="external-link">limma::duplicateCorrelation()</a></code>.
This process only occurs when <code>block</code> is defined, <code>correlation=NULL</code>
and <code>nrow(imatrix) &gt; max_correlation_rows</code>. In this scenario,
a random subset of rows are used to calculate <code>correlation</code>,
then that <code>correlation</code> is used for <code><a href="https://rdrr.io/pkg/limma/man/lmFit.html" class="external-link">limma::lmFit()</a></code>. This
process is intended to help very large data volumes, where
the speed of <code><a href="https://rdrr.io/pkg/limma/man/dupcor.html" class="external-link">limma::duplicateCorrelation()</a></code> is impacted in
quadratic manner by increasing number of rows, while also not
improving the summary correlation value.</p></dd>


<dt>normgroup</dt>
<dd><p><code>character</code> or <code>factor</code> vector with length
<code>ncol(se)</code> or <code>length(isamples)</code> when <code>isamples</code> is defined.
Values define independent normalization groups, which performs
independent analyses within each unique normalization group.
This option is intended for convenience, enabling separate
variance models for each normalization group, which is
appropriate when analyzing very different sample types.
During limma model fit, all samples in all groups are used by default,
which may incorrectly estimate variance when the variability
by row is not uniform across different sample types.
When <code>normgroup=NULL</code> the default is to assume all samples are in
the same <code>normgroup="bulk"</code>.
Each subset of samples begins with the same <code>sedesign</code>, <code>idesign</code>,
<code>icontrast</code>, however they are fed into <code>validate_sestats()</code> to
subset the appropriate contrasts to use only samples within the
current normgroup. As a result, any contrasts that span two
normgroups will be removed, and will not appear in the output.</p></dd>


<dt>do_normgroups</dt>
<dd><p><code>logical</code> whether to enable normgroup processing,
or to use the previous technique that kept all samples together.
This argument may be removed in future, with recommendation to use
<code>normgroup=NULL</code> to disable normalization group processing.
Note that when <code>normgroup=NULL</code> the output should be identical
with <code>do_normgroups=TRUE</code> and <code>do_normgroups=FALSE</code>.</p></dd>


<dt>seed</dt>
<dd><p><code>numeric</code> used to set a random seed with <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code> for
reproducibility. Use <code>seed=NULL</code> to avoid setting a random seed.
Note this action will only affect downstream functions that
employ some form of randomization.</p></dd>


<dt>verbose</dt>
<dd><p><code>logical</code> indicating whether to print verbose output.</p></dd>


<dt>...</dt>
<dd><p>additional arguments are ignored.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>This function is essentially a wrapper around statistical methods
in the <code>limma</code> package, with additional steps to apply statistical
thresholds to define "statistical hits" by three main criteria:</p><ul><li><p>P-value or adjusted P-value</p></li>
<li><p>fold change</p></li>
<li><p>max group mean</p></li>
</ul><p>This function is unique in that it applies the statistical methods
to one or more "signals" in the input <code>SummarizedExperiment</code> assays,
specifically intended to compare things like normalization methods.</p>
<p>If multiple statistical thresholds are defined, each one is applied
in order, which is specifically designed to compare the effect of
applying different statistical thresholds. For example one may want
to pre-compute "statistical hits" using adjusted P-value 0.05, and 0.01;
or using fold change &gt;= 1.5, or fold change &gt;= 2.0. The underlying
statistics are the same, but a column indicating hits is created
for each set of thresholds.</p>
<p>Hits are annotated:</p><ul><li><p><code>-1</code> for down-regulation</p></li>
<li><p><code>0</code> for un-changed (by the given criteria)</p></li>
<li><p><code>1</code> for up-regulation</p></li>
</ul><p>The results are therefore intended to feed directional Venn
diagrams, which display the overlapping gene hits, and whether the
directions are shared or opposed.</p>
<p>This function can optionally apply the limma-voom workflow,
which involves calculating matrix weights using <code><a href="https://rdrr.io/pkg/limma/man/voom.html" class="external-link">limma::voom()</a></code>,
then applying those weights during the model fit.</p>
<p>The output is intended to include several convenient formats:</p><ul><li><p><code>stats_dfs</code> - list of <code>data.frame</code> stats one per contrast</p></li>
<li><p><code>stats_df</code> - one <code>data.frame</code> with all stats together</p></li>
<li><p><code>hit_array</code> - <code>array</code> with three dimensions: signal; contrast; threshold
whose cells contain hit flags (-1, 0, 1) named by <code>rownames(se)</code>.</p></li>
</ul><p>Design and contrast matrices can be defined using the function
<code><a href="groups_to_sedesign.html">jamses::groups_to_sedesign()</a></code>. That function assigns each sample
to a sample group, then assembles all relevant group contrasts
which involve only one-factor contrast at a time. It optionally
defines two-factor contrasts (contrast of contrasts) where
applicable.</p>
<p>A subset of genes (<code>rownames(se)</code>) or samples (<code>colnames(se)</code>) can
be defined, to restrict calculations to use only the subset data.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other jamses stats: 
<code><a href="ebayes2dfs.html">ebayes2dfs</a>()</code>,
<code><a href="handle_na_values.html">handle_na_values</a>()</code>,
<code><a href="matrix_normalize.html">matrix_normalize</a>()</code>,
<code><a href="run_limma_replicate.html">run_limma_replicate</a>()</code>,
<code><a href="se_normalize.html">se_normalize</a>()</code>,
<code><a href="voom_jam.html">voom_jam</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">expr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span> <span class="op">+</span> <span class="fl">7</span>;</span></span>
<span class="r-in"><span><span class="va">noise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">120</span><span class="op">)</span> <span class="op">/</span> <span class="fl">5</span>;</span></span>
<span class="r-in"><span><span class="va">fold</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2.5</span>;</span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">expr</span> <span class="op">+</span> <span class="va">noise</span>, ncol<span class="op">=</span><span class="fl">6</span><span class="op">)</span>;</span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>   <span class="va">m</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">m</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="va">fold</span>;</span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="co"># m &lt;- matrix(rnorm(120)/2 + 5, ncol=6);</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Vehicle"</span>, <span class="st">"Treated"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">3</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"row"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># simulate some "hits"</span></span></span>
<span class="r-in"><span><span class="va">m</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">m</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">+</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="va">m</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">m</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1.5</span></span></span>
<span class="r-in"><span><span class="va">m</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">m</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1.3</span></span></span>
<span class="r-in"><span><span class="co"># create SummarizedExperiment</span></span></span>
<span class="r-in"><span><span class="va">se</span> <span class="op">&lt;-</span> <span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/RangedSummarizedExperiment-class.html" class="external-link">SummarizedExperiment</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>   assays<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>counts<span class="op">=</span><span class="va">m</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   colData<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>sample<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   group<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Vehicle"</span>, <span class="st">"Treated"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Vehicle"</span>, <span class="st">"Treated"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   rowData<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>measurement<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># assign colors</span></span></span>
<span class="r-in"><span><span class="va">sample_color_list</span> <span class="op">&lt;-</span> <span class="fu">platjam</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/platjam/man/design2colors.html" class="external-link">design2colors</a></span><span class="op">(</span><span class="va">se</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="se_contrast_stats-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># heatmap</span></span></span>
<span class="r-in"><span><span class="fu"><a href="heatmap_se.html">heatmap_se</a></span><span class="op">(</span><span class="va">se</span>, sample_color_list<span class="op">=</span><span class="va">sample_color_list</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="se_contrast_stats-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create SEDesign</span></span></span>
<span class="r-in"><span><span class="va">sedesign</span> <span class="op">&lt;-</span> <span class="fu"><a href="groups_to_sedesign.html">groups_to_sedesign</a></span><span class="op">(</span><span class="va">se</span>, group_colnames<span class="op">=</span><span class="st">"group"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot the design and contrasts</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_sedesign.html">plot_sedesign</a></span><span class="op">(</span><span class="va">sedesign</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>no non-missing arguments to max; returning -Inf</span>
<span class="r-plt img"><img src="se_contrast_stats-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># limma contrasts</span></span></span>
<span class="r-in"><span><span class="va">sestats</span> <span class="op">&lt;-</span> <span class="fu">se_contrast_stats</span><span class="op">(</span>se<span class="op">=</span><span class="va">se</span>,</span></span>
<span class="r-in"><span>   sedesign<span class="op">=</span><span class="va">sedesign</span>,</span></span>
<span class="r-in"><span>   assay_names<span class="op">=</span><span class="st">"counts"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># print data.frame summary of hits</span></span></span>
<span class="r-in"><span><span class="fu"><a href="sestats_to_df.html">sestats_to_df</a></span><span class="op">(</span><span class="va">sestats</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 Signal       Contrasts    hit adjp0.05 fc1.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Treated-Vehicle counts Treated-Vehicle 8 hits (4 up, 4 down)</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot the design with number of hits labeled</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_sedesign.html">plot_sedesign</a></span><span class="op">(</span><span class="va">sedesign</span>, sestats<span class="op">=</span><span class="va">sestats</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>no non-missing arguments to max; returning -Inf</span>
<span class="r-plt img"><img src="se_contrast_stats-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># heatmap with hits</span></span></span>
<span class="r-in"><span><span class="fu"><a href="heatmap_se.html">heatmap_se</a></span><span class="op">(</span><span class="va">se</span>,</span></span>
<span class="r-in"><span>   sample_color_list<span class="op">=</span><span class="va">sample_color_list</span>,</span></span>
<span class="r-in"><span>   sestats<span class="op">=</span><span class="va">sestats</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="se_contrast_stats-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># review stats table</span></span></span>
<span class="r-in"><span><span class="va">stats_df</span> <span class="op">&lt;-</span> <span class="va">sestats</span><span class="op">$</span><span class="va">stats_dfs</span><span class="op">$</span><span class="va">counts</span><span class="op">[[</span><span class="st">"Treated-Vehicle"</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">stats_df</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      probes hit adjp0.05 fc1.5 Treated-Vehicle logFC Treated-Vehicle</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> row1   row1                                  1             2.3337734</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> row2   row2                                  1             1.4366480</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> row3   row3                                 -1            -1.8277444</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> row4   row4                                 -1            -0.6312502</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> row5   row5                                  0            -0.5632394</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> row6   row6                                  0            -0.0696241</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      fold Treated-Vehicle P.Value Treated-Vehicle adj.P.Val Treated-Vehicle</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> row1             5.041222            6.410602e-17              1.282120e-15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> row2             2.706912            2.127696e-11              1.418464e-10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> row3            -3.549816            3.099395e-14              3.099395e-13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> row4            -1.548907            3.752311e-04              9.143257e-04</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> row5            -1.477583            1.285519e-03              2.571038e-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> row6            -1.049443            6.392157e-01              7.102397e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      mgm Treated-Vehicle Vehicle mean Treated mean</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> row1            8.681105     6.347332     8.681105</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> row2            8.144589     6.707941     8.144589</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> row3            8.383734     8.383734     6.555990</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> row4            7.098608     7.098608     6.467357</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> row5            7.096697     7.096697     6.533457</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> row6            8.547980     8.547980     8.478356</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># volcano plot for one contrast</span></span></span>
<span class="r-in"><span><span class="fu">jamma</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jamma/man/volcano_plot.html" class="external-link">volcano_plot</a></span><span class="op">(</span><span class="va">stats_df</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ##  (<span style="color: #00FFFF; font-weight: bold;">16:40:42</span>) 02Oct2023:   <span style="color: #FF8700;">volcano_plot(): </span><span style="color: #00AFFF;">sig_colname: </span><span style="color: #FF8700;">adj.P.Val Treated-Vehicle</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ##  (<span style="color: #00FFFF; font-weight: bold;">16:40:42</span>) 02Oct2023:   <span style="color: #FF8700;">volcano_plot(): </span><span style="color: #00AFFF;">lfc_colname: </span><span style="color: #FF8700;">logFC Treated-Vehicle</span> </span>
<span class="r-plt img"><img src="se_contrast_stats-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###############################</span></span></span>
<span class="r-in"><span><span class="co"># simulate a two-way model</span></span></span>
<span class="r-in"><span><span class="va">adjust</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span>;</span></span>
<span class="r-in"><span><span class="va">new_fold</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span>;</span></span>
<span class="r-in"><span><span class="va">se2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">se</span>, <span class="va">se</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">groups2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WT"</span>, <span class="st">"KO"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">6</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   <span class="st">"_"</span>,</span></span>
<span class="r-in"><span>   <span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">$</span><span class="va">group</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">groups2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">groups2</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">groups2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">se2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">groups2</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">se2</span><span class="op">)</span><span class="op">$</span><span class="va">sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">se2</span><span class="op">)</span>;</span></span>
<span class="r-in"><span><span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">se2</span><span class="op">)</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="va">groups2</span>;</span></span>
<span class="r-in"><span><span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">se2</span><span class="op">)</span><span class="op">$</span><span class="va">genotype</span> <span class="op">&lt;-</span> <span class="fu">jamba</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jamba/man/gsubOrdered.html" class="external-link">gsubOrdered</a></span><span class="op">(</span><span class="st">"_.+"</span>, <span class="st">""</span>,</span></span>
<span class="r-in"><span>   <span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">se2</span><span class="op">)</span><span class="op">$</span><span class="va">group</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">se2</span><span class="op">)</span><span class="op">$</span><span class="va">treatment</span> <span class="op">&lt;-</span> <span class="fu">jamba</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jamba/man/gsubOrdered.html" class="external-link">gsubOrdered</a></span><span class="op">(</span><span class="st">"^.+_"</span>, <span class="st">""</span>,</span></span>
<span class="r-in"><span>   <span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">se2</span><span class="op">)</span><span class="op">$</span><span class="va">group</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assays</a></span><span class="op">(</span><span class="va">se2</span><span class="op">)</span><span class="op">$</span><span class="va">counts</span><span class="op">[</span>,<span class="fl">7</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span></span></span>
<span class="r-in"><span>   <span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assays</a></span><span class="op">(</span><span class="va">se2</span><span class="op">)</span><span class="op">$</span><span class="va">counts</span><span class="op">[</span>,<span class="fl">7</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span> <span class="op">+</span> <span class="va">adjust</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assays</a></span><span class="op">(</span><span class="va">se2</span><span class="op">)</span><span class="op">$</span><span class="va">counts</span><span class="op">[</span>,<span class="fl">10</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span></span></span>
<span class="r-in"><span>   <span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assays</a></span><span class="op">(</span><span class="va">se2</span><span class="op">)</span><span class="op">$</span><span class="va">counts</span><span class="op">[</span>,<span class="fl">10</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span> <span class="op">+</span> <span class="va">new_fold</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># assign colors</span></span></span>
<span class="r-in"><span><span class="va">sample_color_list2</span> <span class="op">&lt;-</span> <span class="fu">platjam</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/platjam/man/design2colors.html" class="external-link">design2colors</a></span><span class="op">(</span><span class="va">se2</span>,</span></span>
<span class="r-in"><span>   class_colnames<span class="op">=</span><span class="st">"genotype"</span>,</span></span>
<span class="r-in"><span>   color_sub<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      Vehicle<span class="op">=</span><span class="st">"palegoldenrod"</span>,</span></span>
<span class="r-in"><span>      Treated<span class="op">=</span><span class="st">"firebrick4"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   group_colnames<span class="op">=</span><span class="st">"group"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="se_contrast_stats-7.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># heatmap</span></span></span>
<span class="r-in"><span><span class="va">hm2a</span> <span class="op">&lt;-</span> <span class="fu"><a href="heatmap_se.html">heatmap_se</a></span><span class="op">(</span><span class="va">se2</span>,</span></span>
<span class="r-in"><span>   sample_color_list<span class="op">=</span><span class="va">sample_color_list2</span>,</span></span>
<span class="r-in"><span>   controlSamples<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,</span></span>
<span class="r-in"><span>   center_label<span class="op">=</span><span class="st">"versus WT_Vehicle"</span>,</span></span>
<span class="r-in"><span>   column_title_rot<span class="op">=</span><span class="fl">60</span>,</span></span>
<span class="r-in"><span>   row_cex<span class="op">=</span><span class="fl">0.4</span>,</span></span>
<span class="r-in"><span>   column_cex<span class="op">=</span><span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>   column_title_gp<span class="op">=</span><span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize<span class="op">=</span><span class="fl">8</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   column_split<span class="op">=</span><span class="st">"group"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/draw-dispatch.html" class="external-link">draw</a></span><span class="op">(</span><span class="va">hm2a</span>, column_title<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">hm2a</span>, <span class="st">"hm_title"</span><span class="op">)</span>, merge_legends<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="se_contrast_stats-8.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># heatmap centered by genotype</span></span></span>
<span class="r-in"><span><span class="va">hm2b</span> <span class="op">&lt;-</span> <span class="fu"><a href="heatmap_se.html">heatmap_se</a></span><span class="op">(</span><span class="va">se2</span>,</span></span>
<span class="r-in"><span>   sample_color_list<span class="op">=</span><span class="va">sample_color_list2</span>,</span></span>
<span class="r-in"><span>   controlSamples<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">7</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   control_label<span class="op">=</span><span class="st">"versus vehicle"</span>,</span></span>
<span class="r-in"><span>   column_gap<span class="op">=</span><span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"mm"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   centerby_colnames<span class="op">=</span><span class="st">"genotype"</span>,</span></span>
<span class="r-in"><span>   column_title_rot<span class="op">=</span><span class="fl">60</span>,</span></span>
<span class="r-in"><span>   row_cex<span class="op">=</span><span class="fl">0.4</span>,</span></span>
<span class="r-in"><span>   column_cex<span class="op">=</span><span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>   column_title_gp<span class="op">=</span><span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize<span class="op">=</span><span class="fl">8</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   column_split<span class="op">=</span><span class="st">"group"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/draw-dispatch.html" class="external-link">draw</a></span><span class="op">(</span><span class="va">hm2b</span>, column_title<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">hm2b</span>, <span class="st">"hm_title"</span><span class="op">)</span>, merge_legends<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="se_contrast_stats-9.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create SEDesign</span></span></span>
<span class="r-in"><span><span class="va">sedesign2</span> <span class="op">&lt;-</span> <span class="fu"><a href="groups_to_sedesign.html">groups_to_sedesign</a></span><span class="op">(</span><span class="va">se2</span>, group_colnames<span class="op">=</span><span class="st">"group"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot the design and contrasts</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_sedesign.html">plot_sedesign</a></span><span class="op">(</span><span class="va">sedesign2</span>, label_cex<span class="op">=</span><span class="fl">0.7</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="se_contrast_stats-10.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># note the two-way contrast can be flipped</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_sedesign.html">plot_sedesign</a></span><span class="op">(</span><span class="va">sedesign2</span>, flip_twoway<span class="op">=</span><span class="cn">TRUE</span>, label_cex<span class="op">=</span><span class="fl">0.7</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="se_contrast_stats-11.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># limma contrasts</span></span></span>
<span class="r-in"><span><span class="va">sestats2</span> <span class="op">&lt;-</span> <span class="fu">se_contrast_stats</span><span class="op">(</span>se<span class="op">=</span><span class="va">se2</span>,</span></span>
<span class="r-in"><span>   sedesign<span class="op">=</span><span class="va">sedesign2</span>,</span></span>
<span class="r-in"><span>   assay_names<span class="op">=</span><span class="st">"counts"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># print data.frame summary of hits</span></span></span>
<span class="r-in"><span><span class="fu"><a href="sestats_to_df.html">sestats_to_df</a></span><span class="op">(</span><span class="va">sestats2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                 Signal</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> KO_Vehicle-WT_Vehicle                           counts</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> KO_Treated-WT_Treated                           counts</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> WT_Treated-WT_Vehicle                           counts</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> KO_Treated-KO_Vehicle                           counts</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (KO_Treated-WT_Treated)-(KO_Vehicle-WT_Vehicle) counts</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                                                       Contrasts</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> KO_Vehicle-WT_Vehicle                                                     KO_Vehicle-WT_Vehicle</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> KO_Treated-WT_Treated                                                     KO_Treated-WT_Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> WT_Treated-WT_Vehicle                                                     WT_Treated-WT_Vehicle</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> KO_Treated-KO_Vehicle                                                     KO_Treated-KO_Vehicle</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (KO_Treated-WT_Treated)-(KO_Vehicle-WT_Vehicle) (KO_Treated-WT_Treated)-(KO_Vehicle-WT_Vehicle)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                     hit adjp0.05 fc1.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> KO_Vehicle-WT_Vehicle                            8 hits (4 up, 4 down)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> KO_Treated-WT_Treated                           11 hits (6 up, 5 down)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> WT_Treated-WT_Vehicle                            8 hits (4 up, 4 down)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> KO_Treated-KO_Vehicle                           14 hits (6 up, 8 down)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (KO_Treated-WT_Treated)-(KO_Vehicle-WT_Vehicle) 11 hits (4 up, 7 down)</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot the design with number of hits labeled</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_sedesign.html">plot_sedesign</a></span><span class="op">(</span><span class="va">sedesign2</span>, sestats<span class="op">=</span><span class="va">sestats2</span>, label_cex<span class="op">=</span><span class="fl">0.7</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="se_contrast_stats-12.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># heatmap with hits</span></span></span>
<span class="r-in"><span><span class="va">hm2hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="heatmap_se.html">heatmap_se</a></span><span class="op">(</span><span class="va">se2</span>,</span></span>
<span class="r-in"><span>   sample_color_list<span class="op">=</span><span class="va">sample_color_list2</span>,</span></span>
<span class="r-in"><span>   sestats<span class="op">=</span><span class="va">sestats2</span>,</span></span>
<span class="r-in"><span>   controlSamples<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">7</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   column_gap<span class="op">=</span><span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"mm"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   control_label<span class="op">=</span><span class="st">"versus vehicle"</span>,</span></span>
<span class="r-in"><span>   centerby_colnames<span class="op">=</span><span class="st">"genotype"</span>,</span></span>
<span class="r-in"><span>   row_split<span class="op">=</span><span class="fl">3</span>,</span></span>
<span class="r-in"><span>   row_cex<span class="op">=</span><span class="fl">0.4</span>,</span></span>
<span class="r-in"><span>   column_title_rot<span class="op">=</span><span class="fl">60</span>,</span></span>
<span class="r-in"><span>   column_cex<span class="op">=</span><span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>   column_title_gp<span class="op">=</span><span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize<span class="op">=</span><span class="fl">8</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   column_split<span class="op">=</span><span class="st">"group"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/draw-dispatch.html" class="external-link">draw</a></span><span class="op">(</span><span class="va">hm2hits</span>,</span></span>
<span class="r-in"><span>   column_title<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">hm2hits</span>, <span class="st">"hm_title"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   merge_legends<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="se_contrast_stats-13.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># venn diagram</span></span></span>
<span class="r-in"><span><span class="va">hit_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="hit_array_to_list.html">hit_array_to_list</a></span><span class="op">(</span><span class="va">sestats2</span>,</span></span>
<span class="r-in"><span>   contrast_names<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">jamba</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jamba/man/sdim.html" class="external-link">sdim</a></span><span class="op">(</span><span class="va">hit_list</span><span class="op">)</span>;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       rows   class</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> KO_Vehicle-WT_Vehicle    8 numeric</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> KO_Treated-WT_Treated   11 numeric</span>
<span class="r-in"><span><span class="co"># names(hit_list) &lt;- gsub(":", ",&lt;br&gt;\n", contrast2comp(names(hit_list)))</span></span></span>
<span class="r-in"><span><span class="co"># vo &lt;- venndir::venndir(hit_list, expand_fraction=0.1)</span></span></span>
<span class="r-in"><span><span class="co"># venndir::venndir_legender(venndir_out=vo, setlist=hit_list)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># vo &lt;- venndir::venndir(hit_list, expand_fraction=0.1, proportional=TRUE)</span></span></span>
<span class="r-in"><span><span class="co"># venndir::venndir_legender(venndir_out=vo, setlist=hit_list)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by James M. Ward.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

